<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ColdKeys - Macro Keyboard Manager</title>
    <link rel="stylesheet" href="../lib/auto.css" />
    <link rel="stylesheet" href="style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
  </head>
  <body class="dark-theme">
    <div class="popup-overlay hidden"></div>

    <header>
      <div class="app-title nav-item">
        <h1>ColdKeys</h1>
      </div>
<div class="profile-selector nav-item">
  <div class="profile-circle" id="profile-circle">
    <span class="profile-initial" id="profile-initial">D</span>
  </div>
  
  <!-- Hover popup -->
  <div class="profile-popup" id="profile-popup">
    <div class="profile-grid">
      <div class="profile-option add-new" data-value="custom">
        <div class="profile-mini-circle">
          <i class="fas fa-plus"></i>
        </div>
        <span class="profile-name">New Profile</span>
      </div>
      <div class="profile-option" data-value="default">
        <div class="profile-mini-circle">D</div>
        <span class="profile-name">Default Profile</span>
      </div>
      <div class="profile-option" data-value="gaming">
        <div class="profile-mini-circle">G</div>
        <span class="profile-name">Gaming</span>
      </div>
      <div class="profile-option" data-value="gaming">
        <div class="profile-mini-circle">G</div>
        <span class="profile-name">Gaming</span>
      </div>
    </div>
  </div>
</div>
      <div class="search-box nav-item">
        <i class="fas fa-search"></i>
        <input
          type="text"
          id="search-input"
          placeholder="Search shortcuts..."
        />
      </div>
      <div class="header-controls nav-item">
        <button id="save-profile" class="primary-button">
          <i class="fas fa-save"></i>
        </button>
        <button id="theme-toggle" class="icon-button">
          <i class="fas fa-moon"></i>
        </button>
        <button id="settings-button" class="icon-button">
          <i class="fas fa-cog"></i>
        </button>
      </div>
    </header>

    <div class="layout">
      <aside>
        <div class="sidebar-section">
          <h3>All Devices</h3>
          <div id="device-selector">
            <div class="dev-option" value="loading">
              <i class="fa-solid fa-spinner"></i>
              <p>Loading devices...</p>
            </div>
          </div>
        </div>

        <div class="sidebar-section">
          <h3>Tabs</h3>
          <nav class="nav-links">
            <a href="#assign-macros-panel" class="active" data-mode="assign">
              <i class="fas fa-keyboard"></i> Assign Macros
            </a>
            <a href="#view-actions-panel" data-mode="view">
              <i class="fas fa-list"></i> View Actions
            </a>
            <a href="#device-settings-panel" data-mode="settings">
              <i class="fas fa-sliders-h"></i> Device Settings
            </a>
          </nav>
        </div>
      </aside>

      <main>
        <!-- assign-macros (initaially visible)-->
        <section id="assign-macros-panel" class="panel">
          <table class="shortcut-table">
            <thead>
              <tr>
                <th class="key-column">Key Combination</th>
                <th class="action-column">Action</th>
                <th class="device-column">Device</th>
                <th class="controls-column">Created</th>
                <th class="controls-column">Controls</th>
                <th class="status-column">Status</th>
                <!-- ✅ NEW -->
              </tr>
            </thead>

            <tbody class="shortcuts-container">
              <!-- Shortcut rows will be injected here -->
              <tr class="empty-state">
                <td colspan="4" style="text-align: center; padding: 2rem">
                  <i class="fas fa-keyboard empty-icon"></i>
                  <p>No shortcuts assigned yet</p>
                  <p class="empty-subtitle">
                    Start by selecting a keyboard and adding shortcuts
                  </p>
                </td>
              </tr>
            </tbody>
          </table>

          <button id="add-shortcut" class="floating-button">
            <i class="fas fa-plus"></i>
          </button>
        </section>

        <!-- View Actions Panel (initially hidden) -->
        <section id="view-actions-panel" class="panel hidden">
          <div class="action-filters">
            <button class="filter-button active" data-filter="all">All</button>
            <button class="filter-button" data-filter="system">System</button>
            <button class="filter-button" data-filter="media">Media</button>
            <button class="filter-button" data-filter="window">Window</button>
            <button class="filter-button" data-filter="custom">Custom</button>
          </div>

          <!-- System Controls -->
          <h2 class="action-category-title">System Controls</h2>
          <div class="actions-grid">
            <div class="action-card" data-category="system">
              <div class="action-card-header">
                <div class="action-card-icon">
                  <i class="fas fa-volume-up"></i>
                </div>
                <h3 class="action-card-title">Volume Control</h3>
              </div>
              <p class="action-card-description">
                Control system volume levels with precision.
              </p>
              <div class="action-examples">
                <p class="action-examples-title">Examples:</p>
                <div class="example-list">
                  <div class="example-item">
                    <span class="example-dot"></span>
                    <span>Volume Up</span>
                  </div>
                  <div class="example-item">
                    <span class="example-dot"></span>
                    <span>Volume Down</span>
                  </div>
                  <div class="example-item">
                    <span class="example-dot"></span>
                    <span>Mute Toggle</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="action-card" data-category="system">
              <div class="action-card-header">
                <div class="action-card-icon">
                  <i class="fas fa-power-off"></i>
                </div>
                <h3 class="action-card-title">Power Options</h3>
              </div>
              <p class="action-card-description">
                Control system power states and energy settings.
              </p>
              <div class="action-examples">
                <p class="action-examples-title">Examples:</p>
                <div class="example-list">
                  <div class="example-item">
                    <span class="example-dot"></span>
                    <span>Sleep</span>
                  </div>
                  <div class="example-item">
                    <span class="example-dot"></span>
                    <span>Hibernate</span>
                  </div>
                  <div class="example-item">
                    <span class="example-dot"></span>
                    <span>Lock Computer</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Media Controls -->
          <h2 class="action-category-title">Media Controls</h2>
          <div class="actions-grid">
            <div class="action-card" data-category="media">
              <div class="action-card-header">
                <div class="action-card-icon">
                  <i class="fas fa-music"></i>
                </div>
                <h3 class="action-card-title">Media Playback</h3>
              </div>
              <p class="action-card-description">
                Control media playback for music and videos.
              </p>
              <div class="action-examples">
                <p class="action-examples-title">Examples:</p>
                <div class="example-list">
                  <div class="example-item">
                    <span class="example-dot"></span>
                    <span>Play/Pause</span>
                  </div>
                  <div class="example-item">
                    <span class="example-dot"></span>
                    <span>Next Track</span>
                  </div>
                  <div class="example-item">
                    <span class="example-dot"></span>
                    <span>Previous Track</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Window Management -->
          <h2 class="action-category-title">Window Management</h2>
          <div class="actions-grid">
            <div class="action-card" data-category="window">
              <div class="action-card-header">
                <div class="action-card-icon">
                  <i class="fas fa-window-maximize"></i>
                </div>
                <h3 class="action-card-title">Window Controls</h3>
              </div>
              <p class="action-card-description">
                Manage application window states and properties.
              </p>
              <div class="action-examples">
                <p class="action-examples-title">Examples:</p>
                <div class="example-list">
                  <div class="example-item">
                    <span class="example-dot"></span>
                    <span>Always On Top Toggle</span>
                  </div>
                  <div class="example-item">
                    <span class="example-dot"></span>
                    <span>Maximize/Restore</span>
                  </div>
                  <div class="example-item">
                    <span class="example-dot"></span>
                    <span>Move to Monitor</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="action-card" data-category="window">
              <div class="action-card-header">
                <div class="action-card-icon">
                  <i class="fas fa-desktop"></i>
                </div>
                <h3 class="action-card-title">Application Launch</h3>
              </div>
              <p class="action-card-description">
                Launch applications or open files with a single keypress.
              </p>
              <div class="action-examples">
                <p class="action-examples-title">Examples:</p>
                <div class="example-list">
                  <div class="example-item">
                    <span class="example-dot"></span>
                    <span>Open Application</span>
                  </div>
                  <div class="example-item">
                    <span class="example-dot"></span>
                    <span>Open Website</span>
                  </div>
                  <div class="example-item">
                    <span class="example-dot"></span>
                    <span>Run Script</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Custom Scripts -->
          <h2 class="action-category-title">Custom Actions</h2>
          <div class="actions-grid">
            <div class="action-card" data-category="custom">
              <div class="action-card-header">
                <div class="action-card-icon">
                  <i class="fas fa-code"></i>
                </div>
                <h3 class="action-card-title">Custom Scripts</h3>
              </div>
              <p class="action-card-description">
                Run your own scripts or command sequences.
              </p>
              <div class="action-examples">
                <p class="action-examples-title">Examples:</p>
                <div class="example-list">
                  <div class="example-item">
                    <span class="example-dot"></span>
                    <span>Python Script</span>
                  </div>
                  <div class="example-item">
                    <span class="example-dot"></span>
                    <span>Shell Command</span>
                  </div>
                  <div class="example-item">
                    <span class="example-dot"></span>
                    <span>Keyboard Macro</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
        <!-- Device Settings Panel (initially hidden) -->
        <section id="device-settings-panel" class="panel hidden">
          <div class="panel-header">
            <h2>Keyboard Settings</h2>
            <p class="panel-description">
              Configure how your macro keyboard behaves
            </p>
          </div>

          <div class="settings-container">
            <div class="settings-group">
              <h3>Key Behavior</h3>

              <div class="setting-item">
                <div class="setting-info">
                  <label for="unused-keys">Unused Keys</label>
                  <span class="setting-description"
                    >How unused keys should behave</span
                  >
                </div>
                <div class="setting-control">
                  <select id="unused-keys">
                    <option value="passthrough">Pass Through to System</option>
                    <option value="block">Block (custom Action only)</option>
                    <option value="noblock">
                      Pass & Play (Action and Syatem)
                    </option>
                  </select>
                </div>
              </div>

              <div class="setting-item">
                <div class="setting-info">
                  <label for="key-hold-duration">Key Hold Duration</label>
                  <span class="setting-description"
                    >Time in ms to register a key as being hold</span
                  >
                </div>
                <div class="setting-control">
                  <input
                    type="range"
                    id="key-hold-duration"
                    min="500"
                    max="5000"
                    step="100"
                    value="700"
                  />
                  <div class="range-value">
                    <span id="hold-duration-value">700</span> ms
                  </div>
                </div>
              </div>

              <div class="setting-item">
                <div class="setting-info">
                  <label for="repeat-rate">Key Repeat Rate</label>
                  <span class="setting-description"
                    >How quickly a held key repeats its action</span
                  >
                </div>
                <div class="setting-control">
                  <input
                    type="range"
                    id="repeat-rate"
                    min="50"
                    max="500"
                    step="25"
                    value="150"
                  />
                  <div class="range-value">
                    <span id="repeat-rate-value">150</span> ms
                  </div>
                </div>
              </div>
            </div>

            <div class="settings-group">
              <h3>Device Configuration</h3>

              <div class="setting-item">
                <div class="setting-info">
                  <label for="auto-connect">Auto-Connect</label>
                  <span class="setting-description"
                    >Automatically reconnect to last used keyboard</span
                  >
                </div>
                <div class="setting-control">
                  <label class="toggle">
                    <input type="checkbox" id="auto-connect" checked />
                    <span class="toggle-slider"></span>
                  </label>
                </div>
              </div>

              <div class="setting-item">
                <div class="setting-info">
                  <label for="exclusive-mode">Exclusive Mode</label>
                  <span class="setting-description"
                    >Prevent keyboard input from reaching other
                    applications</span
                  >
                </div>
                <div class="setting-control">
                  <label class="toggle">
                    <input type="checkbox" id="exclusive-mode" checked />
                    <span class="toggle-slider"></span>
                  </label>
                </div>
              </div>

              <div class="setting-item">
                <div class="setting-info">
                  <label for="device-polling">Device Polling Rate</label>
                  <span class="setting-description"
                    >How frequently to check for input (lower is more
                    responsive)</span
                  >
                </div>
                <div class="setting-control">
                  <select id="device-polling">
                    <option value="1">1ms (1000Hz)</option>
                    <option value="2">2ms (500Hz)</option>
                    <option value="4">4ms (250Hz)</option>
                    <option value="8" selected>8ms (125Hz)</option>
                    <option value="16">16ms (62.5Hz)</option>
                  </select>
                </div>
              </div>
            </div>

            <div class="settings-group">
              <h3>Advanced Options</h3>

              <div class="setting-item">
                <div class="setting-info">
                  <label for="key-debounce">Key Debounce Time</label>
                  <span class="setting-description"
                    >Prevents accidental double presses</span
                  >
                </div>
                <div class="setting-control">
                  <input
                    type="range"
                    id="key-debounce"
                    min="0"
                    max="50"
                    step="5"
                    value="10"
                  />
                  <div class="range-value">
                    <span id="debounce-value">10</span> ms
                  </div>
                </div>
              </div>

              <div class="setting-item">
                <div class="setting-info">
                  <label for="debug-mode">Debug Mode</label>
                  <span class="setting-description"
                    >Show detailed logs in console for troubleshooting</span
                  >
                </div>
                <div class="setting-control">
                  <label class="toggle">
                    <input type="checkbox" id="debug-mode" />
                    <span class="toggle-slider"></span>
                  </label>
                </div>
              </div>
            </div>
          </div>

          <div class="settings-actions">
            <button id="reset-settings" class="secondary-button">
              Reset to Defaults
            </button>
            <button id="save-settings" class="primary-button">
              Save Settings
            </button>
          </div>
        </section>
      </main>
    </div>

    <!-- Key Listening Modal -->
    <div id="key-listen-modal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Listening for Key Press</h2>
          <button class="close-button"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body listening-mode">
          <div class="key-visualization">
            <object
              id="keyboard-svg"
              type="image/svg+xml"
              data="./res/keyboard_layout.svg"
              class="keyboard-svg"
            ></object>
          </div>
          <p class="listening-instruction">
            Press the key or key combination you want to assign
          </p>
          <div class="detected-keys hidden">
            <h3>Detected Key:</h3>
            <div class="key-badge-container"></div>
          </div>
          <div class="modal-actions">
            <button class="secondary-button cancel-listen">Cancel</button>
            <button class="primary-button confirm-key disabled">
              Continue
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Assign Action Modal -->
    <div id="assign-action-modal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Assign Action</h2>
          <button class="close-button"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body">
          <div class="selected-key">
            <span>For key: </span>
            <div class="key-badge"></div>
          </div>

          <div class="form-group">
            <label for="action-type">Action Type</label>
            <select id="action-type">
              <option value="launch">Launch Application</option>
              <option value="hotkey">Simulate Hotkey</option>
              <option value="volume">Control Volume</option>
              <option value="media">Media Control</option>
              <option value="script">Custom Script</option>
            </select>
          </div>

          <div class="dynamic-form-container">
            <!-- Dynamic content based on selected action -->
            <div class="form-group launch-fields">
              <label for="app-path">Application Path</label>
              <div class="input-with-button">
                <input
                  type="text"
                  id="app-path"
                  placeholder="C:\Path\To\Application.exe"
                />
                <button class="browse-button">
                  <i class="fas fa-folder-open"></i>
                </button>
              </div>
            </div>
          </div>

          <div class="modal-actions">
            <button class="secondary-button cancel-action">Cancel</button>
            <button class="primary-button save-action">Save Action</button>
          </div>
        </div>
      </div>
    </div>

    <!-- ⚙ Settings Popup Box -->
    <div id="popup-settings" class="settings-popup hidden">
      <div class="popup-header">
        <h2>App Settings</h2>
        <button class="close-button" onclick="togglePopupSettings()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <!-- Settings Group -->
      <div class="settings-group">
        <h3>Interface Preferences</h3>

        <div class="setting-item">
          <div class="setting-info">
            <label for="startup-toggle">Auto Start</label>
            <span class="setting-description"
              >Auto Start ColdKeys when System boots</span
            >
          </div>
          <div class="setting-control">
            <label class="toggle">
              <input type="checkbox" id="startup-toggle" />
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

        <div class="setting-item">
          <div class="setting-info">
            <label for="show-overlays">Show Key Overlays</label>
            <span class="setting-description"
              >Display shortcut overlays on screen</span
            >
          </div>
          <div class="setting-control">
            <label class="toggle">
              <input type="checkbox" id="show-overlays" />
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>
      </div>

      <div class="settings-group">
        <h3>Import / Export</h3>

        <div class="setting-item">
          <div class="setting-info">
            <label>Import Settings</label>
            <span class="setting-description"
              >Drag and drop JSON or click to upload</span
            >
          </div>
          <div class="setting-control">
            <div
              class="drop-zone"
              onclick="triggerFileInput()"
              ondrop="handleDrop(event)"
              ondragover="event.preventDefault()"
            >
              Drop file here or click
            </div>
            <input type="file" id="import-file" accept=".json" hidden />
          </div>
        </div>

        <div class="setting-item">
          <div class="setting-info">
            <label>Export Profile</label>
            <span class="setting-description"
              >Download current settings as JSON</span
            >
          </div>
          <div class="setting-control">
            <button class="export-btn" onclick="exportProfile()">Export</button>
          </div>
        </div>
      </div>

      <div class="settings-group">
        <h3>Other Options</h3>

        <div class="setting-item">
          <div class="setting-info">
            <label for="device-hotkey">Device Hotkey</label>
            <span class="setting-description"
              >Enable universal hotkey toggle</span
            >
          </div>
          <div class="setting-control">
            <label class="toggle">
              <input type="checkbox" id="device-hotkey" />
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

        <div class="setting-item">
          <div class="setting-info">
            <label for="notifications">Notifications</label>
            <span class="setting-description"
              >Show tips, errors and confirmations</span
            >
          </div>
          <div class="setting-control">
            <label class="toggle">
              <input type="checkbox" id="notifications" checked />
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>
      </div>

      <div class="settings-footer">
        <button
          id="reset-app-settings"
          onclick="resetPopupSettings()"
          class="secondary-button"
        >
          Reset to Defaults
        </button>
        <button
          id="save-app-settings"
          onclick="savePopupSettings()"
          class="primary-button"
        >
          Save Settings
        </button>
      </div>
    </div>

    <!-- New Profile Creation Popup -->
<div class="new-profile-overlay" id="new-profile-overlay">
  <div class="new-profile-popup">
    <button class="close-button" onclick="togglePopupSettings()">
      <i class="fas fa-times"></i>
    </button>
    
    <div class="popup-header">
      <h3>Create New Profile</h3>
      <p>Set up your new profile with a name and avatar</p>
    </div>
    
    <div class="popup-content">
      <!-- Profile Preview -->
      <div class="profile-preview-section">
        <div class="profile-preview-circle" id="profile-preview">
          <span class="preview-initial" id="preview-initial">N</span>
          <img class="preview-image" id="preview-image" style="display: none;" alt="Profile">
        </div>
        <label class="image-upload-label">
          <input type="file" id="profile-image-input" accept="image/*" style="display: none;">
          <i class="fas fa-camera"></i>
          <span>Upload Image</span>
        </label>
      </div>
      
      <!-- Profile Name Input -->
      <div class="form-group">
        <label for="profile-name-input">Profile Name</label>
        <input 
          type="text" 
          id="profile-name-input" 
          placeholder="Enter profile name..."
          maxlength="20"
        >
        <div class="char-counter">
          <span id="char-count">0</span>/20
        </div>
      </div>
      
      <!-- Action Buttons -->
      <div class="popup-actions">
        <button class="btn-cancel" onclick="togglePopupSettings()">Cancel</button>
        <button class="btn-create" id="create-profile-btn" disabled>Create Profile</button>
      </div>
    </div>
  </div>
</div>

    <script src="maper.js"></script>
  </body>
</html>
